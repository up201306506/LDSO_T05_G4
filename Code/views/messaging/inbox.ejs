<!DOCTYPE html>
<html>
<head>
    <title><%= title %></title>

    <% include ../templates/header.ejs %>
    <link rel="stylesheet" type="text/css" href="/stylesheets/messaging/inbox.css">

    <!-- Text-area editor with buttons -->
    <script type="text/javascript" src="https://rawgithub.com/mindmup/bootstrap-wysiwyg/master/bootstrap-wysiwyg.js"></script>
    <script src="https://rawgithub.com/mindmup/bootstrap-wysiwyg/master/external/jquery.hotkeys.js"></script>

</head>
<body>
<% include ../templates/navbar.ejs %>
<% include ../templates/alert_messages.ejs %>

<div class="container"id="main_body">
    <div class=row">
        <!-- 3/9 2/10  Buttons on the Left, Inbox on the Right-->
        <!-- Buttons -->
        <div class="col-sm-3 col-md-2">
            <!-- New Message Button -->
            <a href="#" class="btn btn-danger btn-sm btn-block" role="button" data-toggle="modal" data-target="#myModal" id="btn_New_Message">New Message</a>
            <hr>
            <!-- Bottom Buttons -->
            <ul class="nav nav-pills nav-stacked">
                <li class="active"><a href="#"><span class="badge pull-right">New</span> Inbox </a></li>
                <li><a href="#">Offers</a></li>
                <li><a href="#">Important</a></li>
                <li><a href="#">Sent Mail</a></li>
                <li><a href="#">Deleted</a></li>
            </ul>
        </div>

        <!-- Inbox -->
        <div class="col-sm-9 col-md-10" >
            <!-- Header -->
            <div id=Inbox_Header">
                <!-- Mark Read Button -->
                <button type="button" class="btn btn-default pull-right" data-toggle="tooltip" title="Mark all as Read" onclick="markReadButton()">Mark all as Read</button>
                <!-- Refresh Button -->
                <button type="button" class="btn btn-default pull-right" data-toggle="tooltip" title="Refresh" onclick="location.reload();">
                    &nbsp;&nbsp;&nbsp;<span class="glyphicon glyphicon-refresh"></span>&nbsp;&nbsp;&nbsp;</button>
                <!-- Title -->
                <h2><%= user %>'s Inbox</h2>
                <hr>
            </div>


            <!-- Contents -->
            <ul class="list-group" id="Inbox_Contents">

                <% for(var i = 0; i < userMessages.length; i++) { %>
                <li class="list-group-item message_item <%if(!userMessages[i].read){%>active<%}%>">
                    <!-- Star -->
                    <span class="glyphicon glyphicon-star-empty"></span>
                    <!-- Other User's Name -->
                    <a href="./id/<%= userMessages[i]._id %>">
                        <div class="message_sender_username">
                            <span class="message_sender_username_text"><%= userMessages[i].sender %></span>
                        </div>
                        <div class="message_preview">
                            <!-- Message Subject -->
                            <span class="message_subject"><%= userMessages[i].subject %> - </span>
                            <!-- Message Preview -->
                            <span class="message_preview_text"><%= userMessages[i].content %></span>
                        </div>
                    </a>

                    <div class="pull-right">
                        <!-- Type -->
                        <span class="glyphicon glyphicon-<%= userMessages[i].type %>"
                              data-toggle="tooltip" data-placement="left" title="<%= userMessages[i].typePopup %>"></span>
                        <!-- Receive Date -->
                        <span class="badge">25/12/1970</span>
                        <!-- Trash Can -->
                        <a href="#"><span class="glyphicon glyphicon-trash"
                                          data-toggle="tooltip" data-placement="left" title="Delete"></span></a>
                    </div>
                </li>
                <% } %>



                <!-- Example Messages -->
                <% if(false) {%>
                <li class="list-group-item message_item">
                    <!-- Star -->
                    <span class="glyphicon glyphicon-star-empty"></span>
                    <!-- Other User's Name -->
                    <a href="./message"><div class="message_sender_username">
                        <span class="message_sender_username_text">A User</span>
                        </div>
                        <!-- Message Subject -->
                        <span class="message_subject">Subject - </span>
                        <!-- Message Preview -->
                        <div class="message_preview">
                            <span class="message_preview_text">A small preview of the message contents.</span>
                        </div>
                    </a>


                    <div class="pull-right">
                        <!-- Type -->
                        <span class="glyphicon glyphicon glyphicon-leaf"
                              data-toggle="tooltip" data-placement="left" title="Offer Related"></span>
                        <!-- Receive Date -->
                        <span class="badge">12:00 PM</span>
                        <!-- Trash Can -->
                        <a href="#"><span class="glyphicon glyphicon glyphicon glyphicon glyphicon-trash"
                                          data-toggle="tooltip" data-placement="left" title="Delete"></span></a>
                    </div>
                </li>
                <li class="list-group-item message_item active">
                    <!-- Star -->
                    <span class="glyphicon glyphicon-star-empty"></span>
                    <!-- Other User's Name -->
                    <a href="./message">
                        <div class="message_sender_username">
                        <span class="message_sender_username_text">A User WITH A LONG NAAAAAAAAAAAAAAAAAAAAAAAAAME</span>
                        </div>

                        <div class="message_preview">
                            <!-- Message Subject -->
                            <span class="message_subject">Subject - </span>
                            <!-- Message Preview -->
                            <span class="message_preview_text">A small preview of the message contents. I wish this text would disappear on smaller displays.</span>
                        </div>
                    </a>


                    <div class="pull-right">
                        <!-- Type -->
                        <span class="glyphicon glyphicon glyphicon-user"
                              data-toggle="tooltip" data-placement="left" title="Conversation"></span>
                        <!-- Receive Date -->
                        <span class="badge">12:00 PM</span>
                        <!-- Trash Can -->
                        <a href="#"><span class="glyphicon glyphicon glyphicon glyphicon glyphicon-trash"
                                          data-toggle="tooltip" data-placement="left" title="Delete"></span></a>
                    </div>
                </li>
                <%}%>


            </ul>
        </div>

        <!-- Page Navigation  -->
        <div class="pull-right" id="Inbox_Navigation">
            <span id="navigation_text">Page: <muted><b>1</b> of <b>5</b></muted> </span>
            <div class="btn-group">
                <button type="button" class="btn btn-default"><</button>
                <button type="button" class="btn btn-default">></button>
            </div>
        </div>

    </div>
</div>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <form id="New_Message_Form" class="form-horizontal" role="form" action="/message/new" method="post">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4><span class="glyphicon glyphicon-envelope"></span> Send a New Message</h4>
            </div>
            <div class="modal-body">
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="compose_recipient">To:</label>
                        <div class="col-sm-10">
                            <input name="receiver" type="text" class="form-control" id="compose_recipient" placeholder="The username field needs a typeahead implementation">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="compose_subject">Subject:</label>
                        <div class="col-sm-10">
                            <input name="subject" type="text" class="form-control" id="compose_subject" placeholder="Enter Subject">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="control-label col-sm-2" for="compose_type">Type:</label>
                        <div class="col-sm-10">
                            <select id="compose_type" class="form-control" disabled="true">
                                <option value="Conversation" selected>Conversation</option>
                                <option value="Offer">Offer</option>
                            </select>
                            <input name="type" value="conversation" hidden>
                        </div>
                    </div>


                    <!-- TextArea Input. If you're reading this, go HERE: http://mindmup.github.io/bootstrap-wysiwyg/ -->

                    <div class="form-group">
                        <label class="control-label col-sm-2" for="compose_subject">Message:</label>
                        <div class="col-sm-10">
                            <div class="btn-toolbar" data-role="editor-toolbar" data-target="#editor">
                                <div class="btn-group" id="editor-buttons">
                                    <a class="btn" data-edit="bold" title="" data-original-title="Bold (Ctrl/Cmd+B)"><strong>B</strong></a>
                                    <a class="btn" data-edit="italic" title="" data-original-title="Italic (Ctrl/Cmd+I)"><em>I</em></a>
                                    <a class="btn" data-edit="strikethrough" title="" data-original-title="Strikethrough"><s>S</s></a>
                                    <a class="btn" data-edit="underline" title="" data-original-title="Underline (Ctrl/Cmd+U)"><u>U</u></a>
                                </div>
                                <div class="btn-group">
                                    <a class="btn" data-edit="undo" title="Undo (Ctrl/Cmd+Z)">Undo</a>
                                    <a class="btn" data-edit="redo" title="Redo (Ctrl/Cmd+Y)">Redo</a>
                                </div>
                            </div>
                            <div class="">
                                <div id="editor" contenteditable="true"></div>
                            </div>
                            <input id="content_input" name="content" value="" hidden>
                        </div>
                    </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-default" onclick="sendMessage()">Send</button>
            </div>
            </form>
        </div>

    </div>
</div>

<script>
    $(document).ready(function(){
        //Tooltip function initializer
        $('[data-toggle="tooltip"]').tooltip();

        //Textarea Initializer
        $('#editor').wysiwyg();
        $('#launch').click();

    });

    function sendMessage(){
        $('#content_input').attr('value', $('#editor').html());
        $('#New_Message_Form').submit();
    }

    function markReadButton(){
        location.reload();
    }

</script>


</body>
</html>